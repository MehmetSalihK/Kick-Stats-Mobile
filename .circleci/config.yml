version: 2.1

jobs:
  build-ios:
    macos:
      xcode: "14.0.0"  # Assure-toi que la version d'Xcode est disponible pour ton plan
    steps:
      - checkout  # Clonage du dépôt
      - run:
          name: List Project Files
          command: ls -R  # Liste récursive de tous les fichiers et répertoires
      - run:
          name: Check and Install Cocoapods
          command: |
            if [ -d "ios" ]; then
              cd ios
              pod install
            else
              echo "Directory ios does not exist."
              exit 1
            fi
      - run:
          name: Build IPA
          command: |
            xcodebuild \
              -workspace ios/KickStats.xcworkspace \
              -scheme KickStats \
              -configuration Release \
              -sdk iphoneos \
              -archivePath $PWD/build/KickStats.xcarchive archive

            xcodebuild \
              -exportArchive \
              -archivePath $PWD/build/KickStats.xcarchive \
              -exportOptionsPlist ios/exportOptions.plist \
              -exportPath $PWD/build

      - store_artifacts:
          path: build/KickStats.ipa
          destination: ios-app-ipa

workflows:
  version: 2
  build_and_deploy:
    jobs:
      - build-ios
